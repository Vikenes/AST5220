\subsection{Results}\label{ssec:M4:results}


\subsubsection{CMB power spectrum} \label{sssec:M4:results:angular_power_spectrum}
The angular power spectrum is shown in \figref{fig:M4:results:peaks_and_troughs_cells}. We also include data from \cite{Planck2020} for low $\ell$ values. At higher $\ell$, neutrinos, helium and reionization becomes important, and the predicted value of $\cl$ would deviate from that of observations \pnote{Write about how/why these things affect it.} To understand the physics behind the CMB power spectrum, we have also drawn vertical lines showing the peaks (red) and the troughs (blue) in the spectrum. We begin our discussion be qualitatively explaining the main features seen in the power spectrum, before going into further detail. In particular, we will make use of the simple form of \Eqref{eq:M4:theory:Theta_ell_today_SW_approximation} frequently, as it serves as a simple method for gaining insight regarding the main features of the power spectrum. \note{Elaborate on when we use this approximation, and not.} In \secref{sssec:M4:results:contribution_from_individual_components} we will see that the main features of the power spectrum discussed in this section comes from the SW term, meaning that the approximation we use is applicable for our discussion at a superficial level in this section. Later, we will go more into detail \note{Ugh..}.      

The peaks we observe in the power spectrum are a result of the oscillations of the photon baryon plasma. When photons decouple from baryons, modes at different scales will be in different states. If the plasma is fully compressed upon recombination, the photons have to escape from deep potential wells, and will therefore be redshifted. Similarly, if a mode is fully decompressed when recombination happens, the photons can escape without much energy loss. Since $\cl$ depends on the absolute value of the photons multipoles, both of these cases will result in a peak of the power spectrum. The troughs therefore correspond to modes for which the temperature perturbation is approximately zero.  

As seen in \secref{ssec:M3:results}, the size of the modes strongly affect their behaviour before decoupling. Small scale modes will undergo several oscillations before recombination occurs. The number of oscillations a mode undergoes before decoupling decreases for larger scale modes, and for modes larger than the horizon during recombination, we expect no oscillations to take place. Thus, the peak at $\ell=205$ corresponds to a mode that just began to oscillate, with recombination taking place when it was at its maximum. As $\ell$ is decreased from $205$, the modes are gradually less compressed, until we reach scales of modes that had not entered the horizon before decoupling. On the largest angular scales, we see a manifestation of \Eqref{eq:M4:theory:C_ell_SW_plateau_integral}, as the power spectrum is roughly constant, as expected. 
\begin{figure}[ht!]
    \includefig{peaks_and_troughs_cells\pspecresolution}
    \caption{The predicted CMB power spectrum (black) compared with data from Planck at large scales. \note{Fix y-label. Should indicate $\tcmb$}}
    \label{fig:M4:results:peaks_and_troughs_cells}
\end{figure}

To see that the peaks and troughs in \figref{fig:M4:results:peaks_and_troughs_cells} actually correspond to modes where $\Thn$ is at extrema, we plot $\Thn(k,x)$ as a function of $x$ for $k=\lp/\etan$ and $k=\lt/\etan$, shown in \figref{fig:M4:results:theta0_at_peaks_and_troughs}. We also mark the region of $x\sim x\rec$. \note{Comment on why recombination isn't instantaneous.} As evident from the figure, the first three peaks of $\cl$ correspond to modes on scales that are at maxima. The troughs occur at scales that are essentially zero deviation from the initial temperature perturbation. Modes with wavenumber $k\sim\lt/\etan$ give roughly zero contribution to the power spectrum, but there are many modes of different wavenumbers with a non-zero contribution, resulting in the troughs we see in the power spectrum, and not $C_{\lt}=0$. Another important feature, is that the maxima of $\Thn(x)$ in the upper panel of \figref{fig:M4:results:theta0_at_peaks_and_troughs} don't occur at $x=x\rec$. In general, inhomogeneities on scale $k$ contributes to $\cl$ at slightly lower value of $\ell$ than $\ell=k\eta_0$. One reason for this, is that $\jell(x)$ peaks when $\ell$ is slightly smaller than $x$. 
\begin{figure}[ht!] 
    \includefig{Theta0_at_peaks_and_troughs}
    \caption{Computed monopoles for of scale $k=\ell/\eta_0$ for different values of $\ell$. The upper panel are $\ell$ values where the power spectrum peaks, and the lower panel are the $\ell$ values of the power spectrum troughs.}
    \label{fig:M4:results:theta0_at_peaks_and_troughs}
\end{figure}

The next prominent feature in \figref{fig:M4:results:peaks_and_troughs_cells} are the damping of the peaks at small scales. During tight coupling, photons and baryons do not behave exactly as one fluid. In reality, photons travel a certain distance between scattering events, essentially performing random walks. During a Hubble time $H^{-1}$, a photon will scatter $N=\abs{\tau'}=n_e \sigma_T / H$ times. With a mean free path of $\mfp=1/n_e \sigma_T$ for Thomson scattering, the mean distance a photon travels during a Hubble time is 
\begin{equation}
    \lambda_D = \mfp \sqrt{N} = 1 / \sqrt{n_e \sigma_T H},
\end{equation}
On scales smaller than $\ld$, scattering has the effect of smoothing the temperature fluctuations, since photons diffuse over such a region, causing the region to have a single mean temperature. In phase space, this corresponds to a damping on small scales $k_D\gtrsim 2\pi/\ld$. Although recombination is not an instantaneous process, it does occur relatively fast. There will be some random walks undertaken by photons as they decouple, but they will very rapidly start streaming in straight lines as $\ne$ eventually becomes very small. Larger angular scales, are not affected by diffusion of photons over small regions, as it statistically gives the same effect in several directions, and not affecting modes much larger than the diffusion scale itself. 

Diffusion explains the damping at large $\ell$, but not the fact that the first peak is much bigger than the other two. The reason for this, is that the first peak correspond to a mode which compresses just before recombination. The mode enters the horizon during the radiation dominated era, and will shortly decay. As it compresses one time, the potential decays shortly after. Thus, the escaping photons are less redshifted, and we see a net increase in $\cl$ near this angular scale \note{Check all of the above}.

We note that the third peak is higher than the second peak, as opposed to the other peaks, which are all lowered at higher $\ell$. 

\subsubsection{Contribution from individual components} \label{sssec:M4:results:contribution_from_individual_components}
In \figref{fig:M4:results:cells_components}, we plot the power spectrum obtained from the four individual terms in \Eqref{eq:M4:theory:source_function_LOS}. Note that the quadrupole term is non-zero. It can be seen on a logarithmic scale, but since it has a negligible contribution to the power spectrum, compared to the other terms, it has been omitted to better understand how the other terms contribute to the power spectrum.     

The SW term is the dominant contribution to $\cl$, which justifies the choice of considering this term only for the discussion in \secref{sssec:M4:results:angular_power_spectrum}, as it contains all the features relevant for those discussions. 

After the SW effect, the Doppler term is contributing the most to $\cl$. On the largest scales, modes have not entered the horizon before decoupling, resulting in decreasing contribution from this term at the largest scales, as $\Theta_1\simeq0$ here. For the photon baryon plasma, the perturbations, in Fourier space, behaved as waves propagating, with a phase shifted velocity.    
\begin{figure}[ht!]
    \includefig{cells_components\pspecresolution}
    \caption{The total angular power spectrum (dashed blue curve), compared to power spectra computed from individual terms in \Eqref{eq:M4:theory:source_function_LOS}. For each term in the figure, the remaining terms in \Eqref{eq:M4:theory:source_function_LOS} have been set to zero.}
    \label{fig:M4:results:cells_components}
\end{figure}

\subsubsection{Matter power spectrum} \label{sssec:M4:results:matter_power_spectrum}
\begin{figure}[ht!]
    \includefig{matterPS_nk1000}
    \caption{Computed matter power spectrum (solid blue curve), compared with observational data from \note{cite}. The equality scale, $\keq$, is marked as the vertical black line.}
    \label{fig:M4:results:matterPS_nk1000}
\end{figure}




\subsubsection{Photon multipoles} \label{sssec:M4:results:photons_multipoles}
\begin{figure}[ht!]
    \includefig{integrand_thetas\pspecresolution\ellintegrand}
    \caption{The term involved in the integrand of \Eqref{eq:M4:theory:CMB_power_spectrum}, for different values of $\ell$. Note that we scale each integrand by $\ell(\ell+1)$, just as we did for $\cl$. This is done to see each of the terms simultaneously.}
    \label{fig:M4:results:integrand_thetas}
\end{figure}


\begin{figure}[ht!]
    \includefig{thetas\pspecresolution\ellthetas}
    \caption{The transfer function from \Eqref{eq:M4:theory:Theta_ell_LOS_integration} plotted for different values of $\ell$.}
    \label{fig:M4:results:thetas}
\end{figure}